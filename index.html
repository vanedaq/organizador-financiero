<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>💰 Organizador Financiero</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .header {
            background: #667eea;
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 1.5em;
            margin-bottom: 10px;
        }
        
        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #ddd;
        }
        
        .tab {
            flex: 1;
            padding: 15px 10px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
        }
        
        .tab.active {
            background: white;
            color: #667eea;
            border-bottom: 3px solid #667eea;
        }
        
        .content {
            padding: 20px;
            min-height: 400px;
        }
        
        .hidden {
            display: none;
        }
        
        .btn {
            background: #667eea;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            margin: 5px;
        }
        
        .btn:hover {
            background: #5a67d8;
        }
        
        .btn-success { background: #28a745; }
        .btn-danger { background: #dc3545; }
        .btn-warning { background: #ffc107; color: #333; }
        
        .item {
            background: #f8f9fa;
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }
        
        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .item-title {
            font-weight: bold;
            font-size: 1.1em;
        }
        
        .item-amount {
            font-weight: bold;
            font-size: 1.2em;
        }
        
        .summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .summary-card {
            background: #667eea;
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        
        .summary-card h3 {
            font-size: 0.9em;
            margin-bottom: 10px;
            opacity: 0.9;
        }
        
        .summary-card .amount {
            font-size: 1.3em;
            font-weight: bold;
        }
        
        .ingresos { background: #28a745; }
        .gastos { background: #dc3545; }
        .disponible { background: #17a2b8; }
        
        .balance {
            padding: 15px;
            margin: 15px 0;
            border-radius: 10px;
            text-align: center;
            font-weight: bold;
            font-size: 1.1em;
        }
        
        .balance-positive {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .balance-negative {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        input, select {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        .form-row {
            display: flex;
            gap: 10px;
            margin: 10px 0;
        }
        
        .form-row > * {
            flex: 1;
        }
        
        @media (max-width: 768px) {
            .tabs {
                overflow-x: auto;
            }
            
            .tab {
                min-width: 80px;
                font-size: 12px;
            }
            
            .summary {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>💰 Organizador Financiero</h1>
            <p>Control simple de tus finanzas</p>
            <select id="mesSelector" style="width: 200px; margin-top: 10px;">
                <option value="2025-01">Enero 2025</option>
                <option value="2025-02">Febrero 2025</option>
                <option value="2025-03">Marzo 2025</option>
                <option value="2025-04">Abril 2025</option>
                <option value="2025-05">Mayo 2025</option>
                <option value="2025-06">Junio 2025</option>
                <option value="2025-07" selected>Julio 2025</option>
                <option value="2025-08">Agosto 2025</option>
                <option value="2025-09">Septiembre 2025</option>
                <option value="2025-10">Octubre 2025</option>
                <option value="2025-11">Noviembre 2025</option>
                <option value="2025-12">Diciembre 2025</option>
            </select>
        </div>

        <!-- Resumen -->
        <div style="padding: 20px;">
            <div class="summary">
                <div class="summary-card ingresos">
                    <h3>💵 Ingresos</h3>
                    <div class="amount" id="totalIngresos">$0</div>
                </div>
                <div class="summary-card gastos">
                    <h3>💸 Gastos</h3>
                    <div class="amount" id="totalGastos">$0</div>
                </div>
                <div class="summary-card disponible">
                    <h3>💰 Disponible</h3>
                    <div class="amount" id="dineroLibre">$0</div>
                </div>
            </div>
            
            <div id="balanceIndicator" class="balance"></div>
        </div>

        <!-- Pestañas -->
        <div class="tabs">
            <button class="tab active" onclick="mostrarTab('ingresos')">💵 Ingresos</button>
            <button class="tab" onclick="mostrarTab('gastos')">💸 Gastos</button>
            <button class="tab" onclick="mostrarTab('creditos')">💳 Créditos</button>
            <button class="tab" onclick="mostrarTab('datos')">📊 Datos</button>
        </div>

        <div class="content">
            <!-- Ingresos -->
            <div id="ingresos" class="tab-content">
                <h2>💵 Mis Ingresos</h2>
                <button class="btn btn-success" onclick="agregarIngreso()">+ Agregar Ingreso</button>
                <div id="listaIngresos"></div>
            </div>

            <!-- Gastos -->
            <div id="gastos" class="tab-content hidden">
                <h2>💸 Mis Gastos</h2>
                <button class="btn btn-danger" onclick="agregarGasto()">+ Agregar Gasto</button>
                <div id="listaGastos"></div>
            </div>

            <!-- Créditos -->
            <div id="creditos" class="tab-content hidden">
                <h2>💳 Mis Créditos</h2>
                <button class="btn btn-warning" onclick="agregarCredito()">+ Agregar Crédito</button>
                <div id="listaCreditos"></div>
            </div>

            <!-- Datos -->
            <div id="datos" class="tab-content hidden">
                <h2>📊 Gestión de Datos</h2>
                <button class="btn btn-success" onclick="exportarDatos()">📥 Exportar Datos</button>
                <button class="btn btn-warning" onclick="importarDatos()">📤 Importar Datos</button>
                <button class="btn btn-danger" onclick="limpiarDatos()">🗑️ Limpiar Todo</button>
                
                <div style="background: #e8f5e8; padding: 15px; border-radius: 10px; margin: 20px 0;">
                    <h4>💾 Auto-Guardado Activado</h4>
                    <p>Tus datos se guardan automáticamente y no se pierden al cerrar la app.</p>
                </div>
                
                <div id="historial"></div>
            </div>
        </div>
    </div>

    <script>
        // Variables globales
        let mesActual = "2025-07";
        let datos = JSON.parse(localStorage.getItem('organizador_simple') || '{}');

        // Inicialización
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 Organizador Simple iniciado');
            
            // Configurar selector de mes
            document.getElementById('mesSelector').addEventListener('change', function() {
                mesActual = this.value;
                actualizarTodo();
                mostrarMensaje('Mes cambiado a ' + formatearMes(mesActual));
            });
            
            // Inicializar datos de ejemplo si no existen
            if (!datos[mesActual]) {
                datos[mesActual] = {
                    ingresos: [
                        { id: 1, nombre: "Salario", monto: 3000000, fecha: "2025-07-01" }
                    ],
                    gastos: [
                        { id: 1, nombre: "Arriendo", monto: 1000000, fecha: "2025-07-01" }
                    ],
                    creditos: [
                        { 
                            id: 1, 
                            nombre: "Tarjeta Visa", 
                            montoTotal: 2000000, 
                            cuotas: 12, 
                            cuotasPagadas: 3,
                            cuotaMensual: 180000
                        }
                    ]
                };
                guardarDatos();
            }
            
            actualizarTodo();
            mostrarMensaje('✅ App cargada correctamente');
        });

        // Utilidades
        function formatMoney(amount) {
            return new Intl.NumberFormat('es-CO', {
                style: 'currency',
                currency: 'COP',
                minimumFractionDigits: 0
            }).format(amount || 0);
        }

        function formatearMes(mes) {
            const meses = {
                '01': 'Enero', '02': 'Febrero', '03': 'Marzo', '04': 'Abril',
                '05': 'Mayo', '06': 'Junio', '07': 'Julio', '08': 'Agosto',
                '09': 'Septiembre', '10': 'Octubre', '11': 'Noviembre', '12': 'Diciembre'
            };
            const [año, mesNum] = mes.split('-');
            return `${meses[mesNum]} ${año}`;
        }

        function guardarDatos() {
            try {
                localStorage.setItem('organizador_simple', JSON.stringify(datos));
                console.log('💾 Datos guardados');
            } catch (error) {
                console.error('Error guardando:', error);
                alert('Error al guardar datos');
            }
        }

        function mostrarMensaje(mensaje) {
            console.log(mensaje);
            // Podrías agregar un toast aquí si quieres
        }

        // Navegación
        function mostrarTab(tabName) {
            // Ocultar todas las pestañas
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.add('hidden');
            });
            
            // Mostrar la pestaña seleccionada
            document.getElementById(tabName).classList.remove('hidden');
            
            // Actualizar botones
            document.querySelectorAll('.tab').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
        }

        // Actualizar interfaz
        function actualizarTodo() {
            actualizarResumen();
            mostrarIngresos();
            mostrarGastos();
            mostrarCreditos();
            mostrarHistorial();
        }

        function actualizarResumen() {
            const datosMes = datos[mesActual] || { ingresos: [], gastos: [], creditos: [] };
            
            const totalIngresos = datosMes.ingresos.reduce((sum, item) => sum + (item.monto || 0), 0);
            const totalGastosNormales = datosMes.gastos.reduce((sum, item) => sum + (item.monto || 0), 0);
            const totalCreditos = datosMes.creditos.reduce((sum, item) => sum + (item.cuotaMensual || 0), 0);
            const totalGastos = totalGastosNormales + totalCreditos;
            const dineroLibre = totalIngresos - totalGastos;
            
            document.getElementById('totalIngresos').textContent = formatMoney(totalIngresos);
            document.getElementById('totalGastos').textContent = formatMoney(totalGastos);
            document.getElementById('dineroLibre').textContent = formatMoney(dineroLibre);
            
            // Balance
            const indicador = document.getElementById('balanceIndicator');
            if (dineroLibre >= 0) {
                indicador.className = 'balance balance-positive';
                indicador.textContent = `✅ Tienes ${formatMoney(dineroLibre)} disponible`;
            } else {
                indicador.className = 'balance balance-negative';
                indicador.textContent = `⚠️ Déficit de ${formatMoney(Math.abs(dineroLibre))}`;
            }
        }

        // Ingresos
        function mostrarIngresos() {
            const container = document.getElementById('listaIngresos');
            const datosMes = datos[mesActual] || { ingresos: [] };
            
            if (datosMes.ingresos.length === 0) {
                container.innerHTML = '<p>No hay ingresos registrados.</p>';
                return;
            }
            
            container.innerHTML = datosMes.ingresos.map(ingreso => `
                <div class="item">
                    <div class="item-header">
                        <div>
                            <div class="item-title">${ingreso.nombre}</div>
                            <small>${new Date(ingreso.fecha).toLocaleDateString()}</small>
                        </div>
                        <div class="item-amount" style="color: #28a745;">${formatMoney(ingreso.monto)}</div>
                    </div>
                    <button class="btn btn-danger" onclick="eliminar('ingresos', ${ingreso.id})">Eliminar</button>
                </div>
            `).join('');
        }

        function agregarIngreso() {
            const nombre = prompt('Nombre del ingreso:');
            const monto = parseFloat(prompt('Monto:'));
            
            if (nombre && monto > 0) {
                if (!datos[mesActual]) {
                    datos[mesActual] = { ingresos: [], gastos: [], creditos: [] };
                }
                
                datos[mesActual].ingresos.push({
                    id: Date.now(),
                    nombre: nombre,
                    monto: monto,
                    fecha: new Date().toISOString().split('T')[0]
                });
                
                guardarDatos();
                actualizarTodo();
                mostrarMensaje('✅ Ingreso agregado');
            }
        }

        // Gastos
        function mostrarGastos() {
            const container = document.getElementById('listaGastos');
            const datosMes = datos[mesActual] || { gastos: [] };
            
            if (datosMes.gastos.length === 0) {
                container.innerHTML = '<p>No hay gastos registrados.</p>';
                return;
            }
            
            container.innerHTML = datosMes.gastos.map(gasto => `
                <div class="item">
                    <div class="item-header">
                        <div>
                            <div class="item-title">${gasto.nombre}</div>
                            <small>${new Date(gasto.fecha).toLocaleDateString()}</small>
                        </div>
                        <div class="item-amount" style="color: #dc3545;">${formatMoney(gasto.monto)}</div>
                    </div>
                    <button class="btn btn-danger" onclick="eliminar('gastos', ${gasto.id})">Eliminar</button>
                </div>
            `).join('');
        }

        function agregarGasto() {
            const nombre = prompt('Nombre del gasto:');
            const monto = parseFloat(prompt('Monto:'));
            
            if (nombre && monto > 0) {
                if (!datos[mesActual]) {
                    datos[mesActual] = { ingresos: [], gastos: [], creditos: [] };
                }
                
                datos[mesActual].gastos.push({
                    id: Date.now(),
                    nombre: nombre,
                    monto: monto,
                    fecha: new Date().toISOString().split('T')[0]
                });
                
                guardarDatos();
                actualizarTodo();
                mostrarMensaje('✅ Gasto agregado');
            }
        }

        // Créditos
        function mostrarCreditos() {
            const container = document.getElementById('listaCreditos');
            const datosMes = datos[mesActual] || { creditos: [] };
            
            if (datosMes.creditos.length === 0) {
                container.innerHTML = '<p>No hay créditos registrados.</p>';
                return;
            }
            
            container.innerHTML = datosMes.creditos.map(credito => {
                const progreso = (credito.cuotasPagadas / credito.cuotas) * 100;
                
                return `
                    <div class="item">
                        <div class="item-header">
                            <div>
                                <div class="item-title">${credito.nombre}</div>
                                <small>Cuotas: ${credito.cuotasPagadas}/${credito.cuotas}</small>
                                <div style="background: #eee; height: 8px; border-radius: 4px; margin: 5px 0;">
                                    <div style="background: #28a745; height: 100%; width: ${progreso}%; border-radius: 4px;"></div>
                                </div>
                            </div>
                            <div class="item-amount" style="color: #ffc107;">${formatMoney(credito.cuotaMensual)}</div>
                        </div>
                        <div>
                            <small>Total: ${formatMoney(credito.montoTotal)}</small>
                            <button class="btn btn-danger" onclick="eliminar('creditos', ${credito.id})" style="margin-left: 10px;">Eliminar</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function agregarCredito() {
            const nombre = prompt('Nombre del crédito:');
            const montoTotal = parseFloat(prompt('Monto total:'));
            const cuotas = parseInt(prompt('Número de cuotas:'));
            const cuotasPagadas = parseInt(prompt('Cuotas pagadas:')) || 0;
            const cuotaMensual = parseFloat(prompt('Cuota mensual:'));
            
            if (nombre && montoTotal > 0 && cuotas > 0 && cuotaMensual > 0) {
                if (!datos[mesActual]) {
                    datos[mesActual] = { ingresos: [], gastos: [], creditos: [] };
                }
                
                datos[mesActual].creditos.push({
                    id: Date.now(),
                    nombre: nombre,
                    montoTotal: montoTotal,
                    cuotas: cuotas,
                    cuotasPagadas: cuotasPagadas,
                    cuotaMensual: cuotaMensual
                });
                
                guardarDatos();
                actualizarTodo();
                mostrarMensaje('✅ Crédito agregado');
            }
        }

        // Eliminar
        function eliminar(tipo, id) {
            if (confirm('¿Estás seguro de eliminar este elemento?')) {
                datos[mesActual][tipo] = datos[mesActual][tipo].filter(item => item.id !== id);
                guardarDatos();
                actualizarTodo();
                mostrarMensaje('✅ Elemento eliminado');
            }
        }

        // Historial
        function mostrarHistorial() {
            const container = document.getElementById('historial');
            const meses = Object.keys(datos).sort();
            
            if (meses.length === 0) {
                container.innerHTML = '<p>No hay historial disponible.</p>';
                return;
            }
            
            let html = '<h3>📊 Resumen por Mes</h3><table style="width: 100%; border-collapse: collapse; margin-top: 10px;">';
            html += '<tr style="background: #f8f9fa;"><th style="padding: 10px; border: 1px solid #ddd;">Mes</th><th style="padding: 10px; border: 1px solid #ddd;">Ingresos</th><th style="padding: 10px; border: 1px solid #ddd;">Gastos</th><th style="padding: 10px; border: 1px solid #ddd;">Balance</th></tr>';
            
            meses.forEach(mes => {
                const datosMes = datos[mes];
                const ingresos = datosMes.ingresos.reduce((sum, item) => sum + (item.monto || 0), 0);
                const gastos = datosMes.gastos.reduce((sum, item) => sum + (item.monto || 0), 0);
                const creditos = datosMes.creditos.reduce((sum, item) => sum + (item.cuotaMensual || 0), 0);
                const totalGastos = gastos + creditos;
                const balance = ingresos - totalGastos;
                
                html += `
                    <tr>
                        <td style="padding: 10px; border: 1px solid #ddd;">${formatearMes(mes)}</td>
                        <td style="padding: 10px; border: 1px solid #ddd; color: #28a745;">${formatMoney(ingresos)}</td>
                        <td style="padding: 10px; border: 1px solid #ddd; color: #dc3545;">${formatMoney(totalGastos)}</td>
                        <td style="padding: 10px; border: 1px solid #ddd; color: ${balance >= 0 ? '#28a745' : '#dc3545'};">${formatMoney(balance)}</td>
                    </tr>
                `;
            });
            
            html += '</table>';
            container.innerHTML = html;
        }

        // Exportar/Importar/Limpiar
        function exportarDatos() {
            const dataStr = JSON.stringify(datos, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `organizador-financiero-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            mostrarMensaje('✅ Datos exportados');
        }

        function importarDatos() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(event) {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const datosImportados = JSON.parse(e.target.result);
                            if (confirm('¿Importar estos datos? Se reemplazarán los actuales.')) {
                                datos = datosImportados.datos || datosImportados;
                                guardarDatos();
                                actualizarTodo();
                                mostrarMensaje('✅ Datos importados');
                            }
                        } catch (error) {
                            alert('Error al leer el archivo');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            
            input.click();
        }

        function limpiarDatos() {
            if (confirm('¿Eliminar TODOS los datos? Esta acción no se puede deshacer.')) {
                if (confirm('CONFIRMACIÓN FINAL: ¿Estás seguro?')) {
                    localStorage.removeItem('organizador_simple');
                    datos = {};
                    datos[mesActual] = { ingresos: [], gastos: [], creditos: [] };
                    guardarDatos();
                    actualizarTodo();
                    mostrarMensaje('✅ Datos eliminados');
                }
            }
        }

        // Auto-guardar cada 30 segundos
        setInterval(guardarDatos, 30000);

        // Guardar antes de cerrar
        window.addEventListener('beforeunload', guardarDatos);
    </script>
</body>
</html>
